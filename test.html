<!doctype html>
<meta charset="utf-8">
<title>WHEP test</title>
<video id="v" autoplay muted playsinline controls style="width:360px;height:640px;background:#000"></video>
<script>
(async () => {
  const WHEP = "https://edilrepairstechnology.resinellialimentari.workers.dev/whep";
  const v = document.getElementById('v');

  const pc = new RTCPeerConnection({ iceServers:[{urls:'stun:stun.l.google.com:19302'}] });
  pc.addTransceiver('video', {direction:'recvonly'});
  // se vuoi anche audio, decommenta la riga sotto (poi servirÃ  cliccare Play):
  // pc.addTransceiver('audio', {direction:'recvonly'});

  pc.ontrack = (ev) => { v.srcObject = ev.streams[0]; };

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  let res;
  try {
    res = await fetch(WHEP, { method:'POST', headers:{'Content-Type':'application/sdp'}, body: offer.sdp, mode:'cors' });
  } catch (e) {
    alert('CORS/HTTPS verso il Worker non raggiungibile'); return;
  }
  if (!res.ok) { alert('WHEP handshake fallito: ' + res.status + ' ' + res.statusText); return; }
  const answer = await res.text();
  await pc.setRemoteDescription({type:'answer', sdp:answer});
})();
</script>
